<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>weather</title>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <style>

        .coordinates {
            background: rgba(0,0,0,0.5);
            color: #fff;
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding:5px 10px;
            margin: 0;
            font-size: 11px;
            line-height: 18px;
            border-radius: 3px;
            display: none;
        }


    </style>
</head>
<body>
<h1>Test</h1>
<div id='map' style='width: 100%; height: 400px;'></div>
<div id="dayOne"></div>
<div id="dayTwo"></div>
<div id="dayThree"></div>
<div id='coordinates' class='coordinates'></div>

<script
        src="http://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script src="mapbox-geocoder-utils.js"></script>
<script src="keys.js"></script>

<script>

    $(document).ready(function () {



        mapboxgl.accessToken = mapBoxKey;

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v9',
            zoom: 5,

        });


        //Sets center of map at SA,TX

        geocode("San Antonio, Texas", mapBoxKey).then(function(data){
            map.setCenter(data);
            var marker = new mapboxgl.Marker({
                draggable: true
            })
                .setLngLat(data)
                .addTo(map);
            var darkSkyUrl = "https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey + "/29.4241,-98.4936"

            //Sets SA,TX as default

            $.ajax(darkSkyUrl).done(function (data) {
                reverseGeocode({lng: -98.4936, lat: 29.4241}, mapBoxKey).then(function(results){
                    console.log(results);
                    results = results.split(",");
                    results = results.slice(0,2);
                    results = results.join(",")
                    console.log(typeof results)
                    $("h1").html(results)
                })
                console.log(data)
                console.log(data.daily.data[1].humidity)
                console.log(data.daily.data[3])

                var dayOne = "<p><strong>" + data.daily.data[0].temperatureHigh + "° " + "/ " + data.daily.data[0].apparentTemperatureLow + "°"+ "</strong></p>"
                    dayOne += "<p>"+ "<strong>Clouds: </strong>" + data.daily.data[0].summary + "</p>"
                    dayOne += "<p>" + "<strong>Humidity: </strong>"  + data.daily.data[0].humidity +"</p>"
                    dayOne += "<p>" + "<strong>Wind: </strong>" + data.daily.data[0].windSpeed +"</p>"
                    dayOne += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[0].pressure +"</p>"
                    $("#dayOne").html(dayOne)

                var dayTwo = "<p><strong>" + data.daily.data[1].temperatureHigh + "° " + "/ " + data.daily.data[1].apparentTemperatureLow + "°"+ "</strong></p>"
                dayTwo += "<p>"+ "<strong>Clouds: </strong>" + data.daily.data[1].summary + "</p>"
                dayTwo += "<p>" + "<strong>Humidity: </strong>"  + data.daily.data[1].humidity +"</p>"
                dayTwo += "<p>" + "<strong>Wind: </strong>" + data.daily.data[1].windSpeed +"</p>"
                dayTwo += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[1].pressure +"</p>"
                $("#dayTwo").html(dayTwo)

                var dayThree = "<p><strong>" + data.daily.data[2].temperatureHigh + "° " + "/ " + data.daily.data[2].apparentTemperatureLow + "°"+ "</strong></p>"
                dayThree += "<p>"+ "<strong>Clouds: </strong>" + data.daily.data[2].summary + "</p>"
                dayThree += "<p>" + "<strong>Humidity: </strong>"  + data.daily.data[2].humidity +"</p>"
                dayThree += "<p>" + "<strong>Wind: </strong>" + data.daily.data[2].windSpeed +"</p>"
                dayThree += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[2].pressure +"</p>"
                $("#dayThree").html(dayThree)

            })

            //Draggable marker

            function onDragEnd() {

                var lngLat = marker.getLngLat();
                // coordinates.style.display = 'block';
                // coordinates.innerHTML = 'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;
                var darkSkyUrl = "https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey + "/"+lngLat.lat +","+lngLat.lng +""
                $.ajax(darkSkyUrl).done(function (data) {
                    reverseGeocode({lng:lngLat.lng, lat: lngLat.lat}, mapBoxKey).then(function(results){
                        console.log(results);
                        results = results.split(",");
                        results = results.slice(0,2);
                        results = results.join(",")
                        console.log(typeof results)
                        $("h1").html(results)
                    })
                    console.log(data)
                    console.log(data.daily.data[1].humidity)
                    console.log(data.daily.data[3])

                    $("#dayOne").html("<p>"+ data.daily.data[0].temperatureHigh + " " + data.daily.data[0].apparentTemperatureLow + "</p>")

                })

            }

            marker.on('dragend', onDragEnd);

        })


    })
</script>
</body>
</html>