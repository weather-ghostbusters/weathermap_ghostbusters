<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>weather</title>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet'/>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>

        .coordinates {
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 5px 10px;
            margin: 0;
            font-size: 11px;
            line-height: 18px;
            border-radius: 3px;
            display: none;
        }

        .box {
            border: 1px solid dimgrey;
            background-color: rgb(242,242,242);
        }

        body {
            background-color: rgb(173,220,251);

        }


    </style>
</head>

<body>
<h1>Weather Application</h1>
<h2> </h2>
<div id="container" class="mx-auto">
    <div class="row mb-5">

        <div id="dayOne" class="box col ml-5"></div>
        <div id="dayTwo" class="box col"></div>
        <div id="dayThree" class="box col mr-5"></div>
    </div>

    <div class="row ml-4 mr-4">
<div id='map' style='width: 100%; height: 400px;'></div>
    </div>

</div>


<div id='coordinates' class='coordinates'></div>


<script
        src="http://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>


<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script src="mapbox-geocoder-utils.js"></script>
<script src="keys.js"></script>

<script>

    $(document).ready(function () {


        var conditions =
            [
                {
                 condition: 'cloudy-day', icon:
                },
                {
                    condition: 'clear-night', icon:
                },
                {
                    condition: 'rain', icon:
                },
                {
                    condition: 'snow', icon:
                },
                {
                    condition: 'snow', icon:
                },
                {
                    condition: 'sleet', icon:
                },
                {
                    condition: 'wind', icon:
                },
                {
                    condition: 'fog', icon:
                },
                {
                    condition: 'cloudy', icon:
                },
                {
                    condition: 'partly-cloudy-day', icon:
                },
                {
                    condition: 'partly-cloudy-night', icon:
                }

        ];




        mapboxgl.accessToken = mapBoxKey;

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v9',
            zoom: 4,

        });


        //Sets center of map at SA,TX

        geocode("San Antonio, Texas", mapBoxKey).then(function (data) {
            map.setCenter(data);
            var marker = new mapboxgl.Marker({
                draggable: true
            })
                .setLngLat(data)
                .addTo(map);
            var darkSkyUrl = "https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey + "/29.4241,-98.4936"

            //Sets SA,TX as default

            $.ajax(darkSkyUrl).done(function (data) {
                reverseGeocode({lng: -98.4936, lat: 29.4241}, mapBoxKey).then(function (results) {
                    console.log(results);
                    results = results.split(",");
                    results = results.slice(0, 2);
                    results = results.join(",")
                    console.log(typeof results)
                    $("h2").html(results)
                })
                console.log(data)
                console.log(data.daily.data[1].humidity)
                console.log(data.daily.data[3])

                var dayOne = "<p><strong>" + data.daily.data[0].temperatureHigh + "° " + "/ " + data.daily.data[0].apparentTemperatureLow + "°" + "</strong></p>"
                dayOne += "<p>" + "<strong>Clouds: </strong>" + data.daily.data[0].summary + "</p>"
                dayOne += "<p>" + "<strong>Humidity: </strong>" + data.daily.data[0].humidity + "</p>"
                dayOne += "<p>" + "<strong>Wind: </strong>" + data.daily.data[0].windSpeed + "</p>"
                dayOne += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[0].pressure + "</p>"
                $("#dayOne").html(dayOne)

                var dayTwo = "<p><strong>" + data.daily.data[1].temperatureHigh + "° " + "/ " + data.daily.data[1].apparentTemperatureLow + "°" + "</strong></p>"
                dayTwo += "<p>" + "<strong>Clouds: </strong>" + data.daily.data[1].summary + "</p>"
                dayTwo += "<p>" + "<strong>Humidity: </strong>" + data.daily.data[1].humidity + "</p>"
                dayTwo += "<p>" + "<strong>Wind: </strong>" + data.daily.data[1].windSpeed + "</p>"
                dayTwo += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[1].pressure + "</p>"
                $("#dayTwo").html(dayTwo)

                var dayThree = "<p><strong>" + data.daily.data[2].temperatureHigh + "° " + "/ " + data.daily.data[2].apparentTemperatureLow + "°" + "</strong></p>"
                dayThree += "<p>" + "<strong>Clouds: </strong>" + data.daily.data[2].summary + "</p>"
                dayThree += "<p>" + "<strong>Humidity: </strong>" + data.daily.data[2].humidity + "</p>"
                dayThree += "<p>" + "<strong>Wind: </strong>" + data.daily.data[2].windSpeed + "</p>"
                dayThree += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[2].pressure + "</p>"
                $("#dayThree").html(dayThree)

            })

            //Draggable marker

            function onDragEnd() {

                var lngLat = marker.getLngLat();
                // coordinates.style.display = 'block';
                // coordinates.innerHTML = 'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;
                var darkSkyUrl = "https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey + "/" + lngLat.lat + "," + lngLat.lng + ""
                $.ajax(darkSkyUrl).done(function (data) {
                    reverseGeocode({lng: lngLat.lng, lat: lngLat.lat}, mapBoxKey).then(function (results) {
                        console.log(results);
                        results = results.split(",");
                        results = results.slice(0, 2);
                        results = results.join(",")
                        console.log(typeof results)
                        $("h2").html(results)
                    })
                    console.log(data)
                    console.log(data.daily.data[1].humidity)
                    console.log(data.daily.data[3])

                    var dayOne = "<p><strong>" + data.daily.data[0].temperatureHigh + "° " + "/ " + data.daily.data[0].apparentTemperatureLow + "°" + "</strong></p>"
                    dayOne += "<p>" + "<strong>Clouds: </strong>" + data.daily.data[0].summary + "</p>"
                    dayOne += "<p>" + "<strong>Humidity: </strong>" + data.daily.data[0].humidity + "</p>"
                    dayOne += "<p>" + "<strong>Wind: </strong>" + data.daily.data[0].windSpeed + "</p>"
                    dayOne += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[0].pressure + "</p>"
                    $("#dayOne").html(dayOne)

                    var dayTwo = "<p><strong>" + data.daily.data[1].temperatureHigh + "° " + "/ " + data.daily.data[1].apparentTemperatureLow + "°" + "</strong></p>"
                    dayTwo += "<p>" + "<strong>Clouds: </strong>" + data.daily.data[1].summary + "</p>"
                    dayTwo += "<p>" + "<strong>Humidity: </strong>" + data.daily.data[1].humidity + "</p>"
                    dayTwo += "<p>" + "<strong>Wind: </strong>" + data.daily.data[1].windSpeed + "</p>"
                    dayTwo += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[1].pressure + "</p>"
                    $("#dayTwo").html(dayTwo)

                    var dayThree = "<p><strong>" + data.daily.data[2].temperatureHigh + "° " + "/ " + data.daily.data[2].apparentTemperatureLow + "°" + "</strong></p>"
                    dayThree += "<p>" + "<strong>Clouds: </strong>" + data.daily.data[2].summary + "</p>"
                    dayThree += "<p>" + "<strong>Humidity: </strong>" + data.daily.data[2].humidity + "</p>"
                    dayThree += "<p>" + "<strong>Wind: </strong>" + data.daily.data[2].windSpeed + "</p>"
                    dayThree += "<p>" + "<strong>Pressure: </strong>" + data.daily.data[2].pressure + "</p>"
                    $("#dayThree").html(dayThree)

                })

            }

            marker.on('dragend', onDragEnd);

        })


    })
</script>
</body>
</html>